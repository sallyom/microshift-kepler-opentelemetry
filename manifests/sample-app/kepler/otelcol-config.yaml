---
apiVersion: v1
kind: ConfigMap
metadata:
  name: otelcol
  labels:
    app.kubernetes.io/component: exporter
    app.kubernetes.io/name: kepler-exporter
data:
  otel-collector-config: |
    receivers:
      #otlp:
      #  protocols:
      #    grpc:
      #      max_recv_msg_size_mib: 999999999
      prometheus:
        config:
          scrape_configs:
          - job_name: 'otel-collector'
            scrape_interval: 5s
            static_configs:
             - targets: ['<KEPLER_CLUSTER_IP>:9102']
    processors:
      memory_limiter:
        check_interval: 1s
        limit_mib: 2000
        spike_limit_mib: 400
      batch:
    exporters:
      logging:
        loglevel: debug
      prometheusremotewrite:
        endpoint: https://<USERNAME>:<PASSWORD>@<PROMENDPOINTURL>
        # for me looks something like: 
        #endpoint: https://64777:eyJrIjoxxxxxxxxxxxxxxx@prometheus-prod-10-prod-us-central-0.grafana.net/api/prom/push
      #jaeger:
       #endpoint: "oteljaeger-collector.otel.svc.cluster.local:14250" # Jaeger service
       #tls:
       #insecure: true
    service:
      pipelines:
        metrics:
          receivers: [prometheus]
          processors: [batch]
          exporters: [logging,prometheusremotewrite]
        #traces:
        #  receivers: [otlp]
        #  processors: [batch]
        #  exporters: [logging]
